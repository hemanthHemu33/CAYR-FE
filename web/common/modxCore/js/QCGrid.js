"use strict"; var QCGrid = function () { this.containerID = "", this.pagerContainerID = "", this.id = "", this.name = "", this.class = "", this.width = "", this.height = ""; var e = 0, t = !1; this.gridData = {}; var a = this; this._previousHeadCol = null, this._previousRow = null, this.onSubmit = {}, this._onSubmit = function () { try { this.onSubmit(this.gridData.param) } catch (e) { console.log(e.message) } }, this.onRowClick = {}, this.onRowDblClick = {}, this._onRowClick = function (i, r, n) { try { var d = this.gridData.data[i], s = this.gridData.colModel[r]; "click" == n.type && (e = setTimeout((function () { if (!t) try { a.onRowClick(i, r, d, s) } catch (e) { console.log(e.message) } t = !1 }), 250)), "dblclick" == n.type && (clearTimeout(e), t = !0, a.onRowDblClick(i, r, d, s)) } catch (e) { console.log(e.message) } } }; function TestQCGrid() { var e = new QCGrid; e.gridData = { param: { currentPage: 1, totalPages: "", totalRecords: 2e3, recordsPerPage: 50, sortname: "", sortOrder: "", query: "", queryType: "" }, colModel: [{ name: "id", display: "id", width: "50", sortable: !0, align: "left", hide: !1, sqlField: "" }, { name: "Summary", display: "Summarry", width: "100", sortable: !0, align: "left", hide: !1, sqlField: "" }, { name: "Name", display: "Name", width: "300", sortable: !0, align: "left", hide: !1, sqlField: "" }, { name: "AssignedTo", display: "Assigned to", width: "200", sortable: !0, align: "right", hide: !1, sqlField: "" }, { name: "CreatedDate", display: "Created Date", width: "150", sortable: !0, align: "center", hide: !1, sqlField: "" }], data: [{ id: 123456, Summary: "Ticket 1", Name: "My name 1", AssignedTo: "user 1", CreatedDate: "Jan-20-2019" }, { id: 123675, Summary: "Ticket 2", Name: "My name 2", AssignedTo: "user 2", CreatedDate: "Jan-20-2019" }, { id: 138648, Summary: "Ticket 3", Name: "My name 3", AssignedTo: "user 3", CreatedDate: "Jan-20-2019" }, { id: 175205, Summary: "Ticket 4", Name: "My name 4", AssignedTo: "user 4", CreatedDate: "Jan-20-2019" }, { id: 175205, Summary: "Ticket 5", Name: "My name 5", AssignedTo: "user 4", CreatedDate: "Jan-20-2019" }, { id: 123456, Summary: "Ticket 1", Name: "My name 1", AssignedTo: "user 1", CreatedDate: "Jan-20-2019" }, { id: 123675, Summary: "Ticket 2", Name: "My name 2", AssignedTo: "user 2", CreatedDate: "Jan-20-2019" }, { id: 138648, Summary: "Ticket 3", Name: "My name 3", AssignedTo: "user 3", CreatedDate: "Jan-20-2019" }, { id: 175205, Summary: "Ticket 4", Name: "My name 4", AssignedTo: "user 4", CreatedDate: "Jan-20-2019" }, { id: 175205, Summary: "Ticket 5", Name: "My name 5", AssignedTo: "user 4", CreatedDate: "Jan-20-2019" }] }, e.id = "tblUserTickets", e.containerID = "inTicketsGrid", e.width = "600px", e.height = "300px", e.class = "table table-bordered table-striped table-hover in-grid-table", e.bind(), e.onSubmit = function (e) { console.log(pg.currentPage) }, e.onRowClick = function (e, t, a, i) { console.log("row-click") }, e.onRowDblClick = function (e, t, a, i) { console.log("row-dblclick") } } QCGrid.prototype = { _setTotalPages: function () { var e = this.gridData.param, t = (e.totalRecords, e.recordsPerPage, Math.ceil(e.totalRecords / e.recordsPerPage)); this.gridData.param.totalPages = t }, getRow: function (e) { return this.gridData.data[e] }, _emptyTbody: function (e) { var t = $(e)[0], a = t.getElementsByTagName("tbody")[0]; t.removeChild(a) }, clearBind: function () { "" != this.containerID && $("#" + this.containerID).html(""); "" != this.pagerContainerID && $("#" + this.pagerContainerID).html("") }, bind: function () { if (0 == this._NoDataCheck()) return !1; if ("undefined" != (e = $("#" + this.id))[0] && null != e[0]) return this._emptyTbody(e), this.gridData.colModel = e[0].colModel, void this._bindData(e); this._createTableContainer(); var e = this._createTable(); this._createHeader(e), this._bindData(e), this._setTotalPages(), this._createPager(), e[0].colModel = this.gridData.colModel, null == this.AddGridConfigrationIcon && null == this.AddGridConfigrationIcon || this.AddGridConfigrationIcon() }, _NoDataCheck: function () { var e = this.gridData.colModel, t = this.gridData.data, a = "", i = this.containerID + "_gridMSgID"; return $("#" + i).remove(), null == e || "undefined" == e || 0 == e.length ? (a = '<div id="' + i + '">There is an issue with the col model or col model not defined</div>', $("#" + this.containerID).html(a), !1) : null == t || "undefined" == t || 0 == t.length ? (a = '<div id="' + i + '">No grid data available</div>', $("#" + this.containerID).html(a), !1) : void 0 }, _createTableContainer: function () { var e = $('<div id="' + this.containerID + '_QCGridContainer" style="position:relative;top:0;left:0;"></div>'); e.css("width", this.width), e.css("height", this.height), $("#" + this.containerID).append(e) }, _createTableFixedHeader: function () { var e = this.id + "_QCGridHeader", t = this.class, a = $('<div id="' + this.containerID + 'QCGridHeader" style="position:sticky;top:0;left:0;z-index:102"></div>'); a.css("width", this.width); var i = $('<table id="' + e + '" cellpadding="0" cellspacing="0" ></table>').addClass(t); return a.append(i), $("#" + this.containerID + "_QCGridContainer").append(a), i }, _createTable: function () { var e = this.id, t = this.class, a = $('<div id="' + this.containerID + '_QCGrid" style="position:relative;top:0px;left:0px;overflow:auto;"></div>').addClass("tablewraper"); a.css("width", this.width), a.css("height", this.height); var i = $('<table id="' + e + '" cellpadding="0" cellspacing="0" ></table>').addClass(t); return a.append(i), $("#" + this.containerID + "_QCGridContainer").append(a), i }, _createHeader: function (e) { var t = this.id, a = this.gridData.colModel, i = document.createElement("thead"); i.setAttribute("data-evl", "EVL_QC_HEAD"); for (var r = document.createElement("tr"), n = 0; n < a.length; n++) { var d = a[n], s = document.createElement("th"); s.id = t + "_col" + n, s.setAttribute("data-ev-data", n), s.innerHTML = d.display, d.width && $(s).css("width", d.width), d.hide && (s.hidden = !0), $(r).append(s) } return $(i).append(r), i.addEventListener("click", this), $(e).prepend(i), e }, _bindData: function (e) { var t = this.gridData.colModel, a = this.gridData.data, i = (this.id, document.createElement("tbody")); i.setAttribute("data-evl", "EVL_QC_BODY"), $(e).append(i); var r = 0; $(a).each((function (e, a) { var n = i.insertRow(-1); n.setAttribute("data-ev-data", r), r++, $(t).each((function (e, t) { 0 == t.hide && $(n.insertCell(-1)).html(a[t.name]) })) })), i.addEventListener("click", this), i.addEventListener("dblclick", this) }, _createPager: function () { var e = this.gridData.param, t = $('<div data-evl="EVL_QC_PAGER"></div>').addClass("d-inline-block"), a = '<input data-ev="EV_QC_PG_CHANGE" data-id="' + this.id + 'qc_pg" type="number" style=";width:2.5rem;border: 1px solid #ccc;" class="in-grid-pgbtn-xs" value="' + e.currentPage + '"/>', i = '<span class="">' + e.totalPages + "</span>", r = '<span class="">Total records ' + e.totalRecords + "</span>"; if (t.append('<a href="#" class="in-grid-pgbtn-xs" data-ev="EV_TKT_REFRESH" title="Refresh" ><i class="fas fa-retweet" data-ev="EV_TKT_REFRESH"></i></a>'), t.append('<a href = "#" class="in-grid-pgbtn-xs" data-ev="EV_QC_PG_FIRST" >First</a>'), t.append('<a href="#" class="in-grid-pgbtn-xs"   data-ev="EV_QC_PG_PREV" >Prev</a>'), t.append(a), t.append('<span class=""> of </span>'), t.append(i), t.append('<a href="#" class="in-grid-pgbtn-xs" data-ev="EV_QC_PG_NEXT" >Next</a>'), t.append('<a href="#" class="in-grid-pgbtn-xs" data-ev="EV_QC_PG_LAST" >Last</a>'), t.append('<span style="padding: 0.1rem 0.5rem;">|</span>'), t.append(r), "" != this.pagerContainerID) $("#" + this.pagerContainerID).append(t); var n = $("#" + this.containerID + "_QCGridPager"), d = $('<div id="' + this.containerID + '_QCGridPager" style="position:relative;bottom:0;border-color: #5090C1;background-color: #EEE;border-radius: 0 !important;padding:.2rem;border-top:1px solid #CCC;"></div>').addClass("d-block"), s = t.clone(); "undefined" == n[0] || null == n[0] ? (d.append(s), $("#" + this.containerID + "_QCGridContainer").append(d)) : (n.empty(), d.append(s)), t[0].addEventListener("click", this), s[0].addEventListener("click", this), t[0].addEventListener("change", this), s[0].addEventListener("change", this) }, pagerEventHandler: function (e, t) { var a = this.gridData.param, i = a.currentPage; if ("change" == t.type && "EV_QC_PG_CHANGE" == e) { var r = parseInt(t.target.value); i = "NaN" == r || r <= 0 ? 0 : r - 1, e = "EV_QC_PG_NEXT" } switch (e) { case "EV_QC_PG_FIRST": case "EV_TKT_REFRESH": i = 1; break; case "EV_QC_PG_PREV": i = i - 1 <= 0 ? 1 : i - 1; break; case "EV_QC_PG_NEXT": i = i + 1 >= a.totalPages ? a.totalPages : i + 1; break; case "EV_QC_PG_LAST": i = a.totalPages; break; default: return !1 }t.preventDefault(), this.gridData.param.currentPage = i, $('[data-id="' + this.id + 'qc_pg"]').val(i), this._onSubmit() }, _bodyEventHandler: function (e) { var t = e.target, a = $(t).parent(), i = a.attr("data-ev-data"), r = parseInt(i), n = t.cellIndex, d = this._previousRow; if (null !== d || null != d) { var s = d.attr("data-ev-data"); parseInt(s); d.removeClass("tr-select") } a.addClass("tr-select"), this._previousRow = a, this._onRowClick(r, n, e) }, _headEventHandler: function (e) { var t = e.target, a = t.cellIndex; if (null != a) { a = t.getAttribute("data-ev-data"); var i = this.gridData.colModel[a]; if (0 != i.sortable) { var r = this._previousHeadCol, n = -1; null == r && null == r || (n = r.getAttribute("data-ev-data"), r.style.borderTop = "none", r.style.borderBottom = "none"), this.gridData.param.sortname = i.name, this.gridData.param.sortOrder = "asc" == this.gridData.param.sortOrder && a == n ? "desc" : "asc", "asc" == this.gridData.param.sortOrder ? (t.style.borderTop = "2px solid blue", t.style.borderBottom = "none") : (t.style.borderTop = "none", t.style.borderBottom = "2px solid orange"), this._previousHeadCol = t, this._onSubmit() } } }, handleEvent: function (e) { var t = e.target, a = e.currentTarget, i = (t.id, t.getAttribute("data-ev")); switch (a.getAttribute("data-evl")) { case "EVL_QC_PAGER": this.pagerEventHandler(i, e); break; case "EVL_QC_BODY": this._bodyEventHandler(e); break; case "EVL_QC_HEAD": this._headEventHandler(e) } } };